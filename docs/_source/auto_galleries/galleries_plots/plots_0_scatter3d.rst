
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "_source\auto_galleries\galleries_plots\plots_0_scatter3d.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download__source_auto_galleries_galleries_plots_plots_0_scatter3d.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr__source_auto_galleries_galleries_plots_plots_0_scatter3d.py:


========================================
3D Scatter Plot
========================================

.. GENERATED FROM PYTHON SOURCE LINES 9-10

Installation

.. GENERATED FROM PYTHON SOURCE LINES 10-14

.. code-block:: Python


    # To install the required package, use the following command:
    # !pip install mocharts








.. GENERATED FROM PYTHON SOURCE LINES 15-16

Simple 3D Scatter

.. GENERATED FROM PYTHON SOURCE LINES 16-31

.. code-block:: Python


    import mocharts as mc
    from sklearn.datasets import load_iris
    from IPython.display import HTML

    iris = load_iris()
    X = iris.data
    y = iris.target

    fig = mc.scatter3Dplot(x=X[:,0], y=X[:,1], z=X[:,2], color='orange')
    fig.set_figsize((6,6))
    # fig.show()
    HTML(fig.show(return_html=True, silent=True))







.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

                <!DOCTYPE html>
                <html lang="en" style="height: 100%">
                <head>
                <meta charset="utf-8">
                </head>
                <body style="height: 100%; margin: 0">

            
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
            
                <div id="1742883546.3310120.2218" style="height: 600px; width: 600px; overflow: auto"></div>
            
                <script type="text/javascript">
                var dom = document.getElementById('1742883546.3310120.2218');
                dom.innerHTML = ""
                dom.setAttribute('_echarts_instance_', '')
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
        option = {"chart_id": "1742883546.3310120.2218", "link_id": null, "figname": "", "title": null, "grid3D": {"show": true, "width": "auto", "height": "auto", "zlevel": -10, "left": "5%", "top": "10%", "right": "5%", "bottom": "5%", "boxWidth": 100, "boxHeight": 100, "boxDepth": 100, "environment": "auto", "viewControl": {"alpha": 45, "beta": 45, "maxAlpha": 360, "distance": 250}, "changed_name_key": {}}, "legend": null, "xAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": 3.94, "max": 8.26, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "yAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": 1.76, "max": 4.64, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "zAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": 0.41, "max": 7.49, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "brush": null, "series": [{"type": "scatter3D", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [4.3, 3.0, 1.1], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 3.2, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 3.0, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 2.9, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.5, 2.3, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.6, 1.0], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.4, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.2, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.7, 3.2, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.7, 3.2, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.4, 1.9], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.4, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.1, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 2.4, 3.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 2.5, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.6, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.5, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.4, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.3, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.2, 1.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.5, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 2.0, 3.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 2.3, 3.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.6, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.0, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 2.5, 3.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.5, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.5, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.3, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 4.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 3.4, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 3.5, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 2.7, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.3, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.0, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.9, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.4, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.9, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 3.5, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.6, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 4.2, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.3, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.4, 3.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.4, 3.8], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.5, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 3.0, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.8, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 3.0, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.5, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.7, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.9, 3.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.6, 3.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.9, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.8, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 4.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.8, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.5, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 3.8, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 3.0, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 4.0, 1.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.6, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.8, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.0, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.0, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.2, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.9, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 3.0, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 3.4, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.2, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.2, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 3.0, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.6, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.8, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.9, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.8, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 3.0, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.2, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.9, 4.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 3.4, 5.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.8, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.5, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.7, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.5, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.3, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.8, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.3, 6.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.3, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.4, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.9, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.8, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.8, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.1, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.2, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.2, 5.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.9, 4.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.7, 5.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.2], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 2.8, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.2, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.6, 2.9, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.6, 3.0, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 2.5, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.0, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.3, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.0, 5.2], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.3, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 3.2, 5.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 2.8, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 3.0, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 5.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.2, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.0, 3.2, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.1, 3.0, 5.9], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.0, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.2, 6.0], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.6, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.3, 2.9, 6.3], "itemStyle": {"opacity": 1.0}}, {"value": [7.4, 2.8, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.6, 3.0, 6.6], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 2.8, 6.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 2.6, 6.9], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 3.8, 6.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 3.0, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.9, 3.8, 6.4], "itemStyle": {"opacity": 1.0}}], "silent": false, "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "orange", "blendMode": "source-over", "symbol": "circle", "symbolSize": 10, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataView": {"readOnly": "false"}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": null, "dataZoom": null, "radar": null, "event": null, "graphic": null, "figsize": {"height": 600, "width": 600}, "color": ["#1f77b4", "#ff7f0e", "#2ca02c", "#e377c2", "#9467bd", "#d62728", "#8c564b", "#bcbd22", "#17becf", "#7f7f7f"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5005"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };function support_popup(option, height, width, inner_html) {
      option['toolbox']['feature']['myFeature'] = {
        show: true,
        title: 'Open in new window',
        icon: "image://data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iNDhweCIgd2lkdGg9IjQ4cHgiIHZpZXdCb3g9IjE2MCAtODAwIDY0MCA2NDAiIGZpbGw9IiM2NjY2NjYiPg0KICA8cGF0aCBkPSJNMjE1LjM4LTE2MHEtMjMuMDUgMC0zOS4yMi0xNi4xNlExNjAtMTkyLjMzIDE2MC0yMTUuMzh2LTUyOS4yNHEwLTIzLjA1IDE2LjE2LTM5LjIyUTE5Mi4zMy04MDAgMjE1LjM4LTgwMGgyMjQuMzl2MzAuNzdIMjE1LjM4cS05LjIzIDAtMTYuOTIgNy42OS03LjY5IDcuNjktNy42OSAxNi45MnY1MjkuMjRxMCA5LjIzIDcuNjkgMTYuOTIgNy42OSA3LjY5IDE2LjkyIDcuNjloNTI5LjI0cTkuMjMgMCAxNi45Mi03LjY5IDcuNjktNy42OSA3LjY5LTE2Ljkydi0yMjQuMzlIODAwdjIyNC4zOXEwIDIzLjA1LTE2LjE2IDM5LjIyUTc2Ny42Ny0xNjAgNzQ0LjYyLTE2MEgyMTUuMzhabTE3MS4yNC0yMDQuMzgtMjItMjIuMjQgMzgyLjYxLTM4Mi42MUg1NDEuMzFWLTgwMEg4MDB2MjU4LjY5aC0zMC43N1YtNzQ3TDM4Ni42Mi0zNjQuMzhaIi8+DQo8L3N2Zz4NCg==",
        onclick: function (){
          var height_ = Math.min(screen.height, Math.round(1.5 * parseInt(height.slice(0,-2))))
          var width_ = Math.min(screen.width, Math.round(1.5 * parseInt(width.slice(0,-2))))
          var left = (screen.width/2)-(width_/2);
          var top = (screen.height/2)-(height_/2);
          var win = window.open('template.html', '_blank',
            `height=${height_}px, width=${width_}px, top=${top}px, left=${left}px`,
          );
          win.document.write(`${inner_html}`);
          win.document.close();
        }
      };
      return option;
    };option = support_popup(option=option, height="600px", width="600px", inner_html=`

            <html lang="en" style="height: 100%; text-align: -webkit-center; align-content: center">
            <title>MoCharts</title>
            <head> <meta charset="utf-8"> </head>
            <body style="height: 100%; margin: 0">
        
        
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"><\/script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"><\/script>
            

            <div id="1742883546.3310120.2218" style="height: 90%; width: 90%"></div>
            <script type="text/javascript">
                var dom = document.getElementById('1742883546.3310120.2218');
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
            option = {"chart_id": "1742883546.3310120.2218", "link_id": null, "figname": "", "title": null, "grid3D": {"show": true, "width": "auto", "height": "auto", "zlevel": -10, "left": "5%", "top": "10%", "right": "5%", "bottom": "5%", "boxWidth": 100, "boxHeight": 100, "boxDepth": 100, "environment": "auto", "viewControl": {"alpha": 45, "beta": 45, "maxAlpha": 360, "distance": 250}, "changed_name_key": {}}, "legend": null, "xAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": 3.94, "max": 8.26, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "yAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": 1.76, "max": 4.64, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "zAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": 0.41, "max": 7.49, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "brush": null, "series": [{"type": "scatter3D", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [4.3, 3.0, 1.1], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 3.2, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 3.0, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 2.9, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.5, 2.3, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.6, 1.0], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.4, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.2, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.7, 3.2, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.7, 3.2, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.4, 1.9], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.4, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.1, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 2.4, 3.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 2.5, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.6, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.5, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.4, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.3, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.2, 1.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.5, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 2.0, 3.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 2.3, 3.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.6, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.0, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 2.5, 3.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.5, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.5, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.3, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 4.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 3.4, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 3.5, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 2.7, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.3, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.0, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.9, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.4, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.9, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 3.5, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.6, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 4.2, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.3, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.4, 3.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.4, 3.8], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.5, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 3.0, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.8, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 3.0, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.5, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.7, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.9, 3.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.6, 3.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.9, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.8, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 4.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.8, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.5, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 3.8, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 3.0, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 4.0, 1.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.6, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.8, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.0, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.0, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.2, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.9, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 3.0, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 3.4, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.2, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.2, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 3.0, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.6, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.8, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.9, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.8, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 3.0, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.2, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.9, 4.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 3.4, 5.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.8, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.5, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.7, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.5, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.3, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.8, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.3, 6.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.3, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.4, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.9, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.8, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.8, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.1, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.2, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.2, 5.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.9, 4.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.7, 5.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.2], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 2.8, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.2, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.6, 2.9, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.6, 3.0, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 2.5, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.0, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.3, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.0, 5.2], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.3, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 3.2, 5.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 2.8, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 3.0, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 5.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.2, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.0, 3.2, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.1, 3.0, 5.9], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.0, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.2, 6.0], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.6, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.3, 2.9, 6.3], "itemStyle": {"opacity": 1.0}}, {"value": [7.4, 2.8, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.6, 3.0, 6.6], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 2.8, 6.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 2.6, 6.9], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 3.8, 6.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 3.0, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.9, 3.8, 6.4], "itemStyle": {"opacity": 1.0}}], "silent": false, "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "orange", "blendMode": "source-over", "symbol": "circle", "symbolSize": 10, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataView": {"readOnly": "false"}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": null, "dataZoom": null, "radar": null, "event": null, "graphic": null, "figsize": {"height": 600, "width": 600}, "color": ["#1f77b4", "#ff7f0e", "#2ca02c", "#e377c2", "#9467bd", "#d62728", "#8c564b", "#bcbd22", "#17becf", "#7f7f7f"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5005"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };option = custom_tooltip(option=option, dimension=3);option = auto_component_size(option=option);option = hide_min_max_axis_label(option=option);getScreenSize(option=option);

                myChart.setOption(option);
                window.addEventListener('resize', function () {
                    myChart.resize();
                    var option_copy = JSON.parse(JSON.stringify(option));
                    option_copy['figsize']['height'] = myChart.getHeight();
                    option_copy['figsize']['width'] = myChart.getWidth();
                    // option_copy = auto_component_size(option_copy);
                    myChart.setOption(option_copy);
                });
            <\/script>
            </body>
            </html>
        <style>
    .dg.main.taller-than-window .close-button {
        border-top: 1px solid #ddd;
    }

    .dg.main .close-button {
        background-color: #e8e8e8;
    }
 
    .dg.main .close-button:hover {
        background-color: #ddd;
    }

    .dg {
        color: #555;
        text-shadow: none !important;
    }

    .dg.main::-webkit-scrollbar {
        background: #fafafa;
    }

    .dg.main::-webkit-scrollbar-thumb {
        background: #bbb;
    }
 
    .dg li:not(.folder) {
        background: #fafafa;
        border-bottom: 1px solid #ddd;
    }
 
    .dg li.save-row .button {
        text-shadow: none !important;
    }

    .dg li.title {
        background: #e8e8e8 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
    }

    .dg .cr.function:hover,.dg .cr.boolean:hover {
        background: #fff;
    }
 
    .dg .c input[type=text] {
        background: #e9e9e9;
    }
 
    .dg .c input[type=text]:hover {
        background: #eee;
    }
 
    .dg .c input[type=text]:focus {
        background: #eee;
        color: #555;
    }
 
    .dg .c .slider {
        background: #e9e9e9;
    }

    .dg .c .slider:hover {
        background: #eee;
    }<\/style>`);option = custom_tooltip(option=option, dimension=3);option = auto_component_size(option=option);option = hide_min_max_axis_label(option=option);getScreenSize(option=option);

                if (option && typeof option === 'object') {
                    myChart.setOption(option);
                    }

                auto_axis_namegap(echarts_instance=myChart, auto_axis_list=[0], axis_type="3d");

            </script>
            </body>
            </html>
    
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 32-33

Custom 3D Scatter Plot

.. GENERATED FROM PYTHON SOURCE LINES 33-46

.. code-block:: Python


    fig = mc.scatter3Dplot(x=X[:,0], y=X[:,1], z=X[:,2], label=y, symbol_size=15, show_label=True,
                           label_distance_ratio=2., symbol='arrow', label_order=[2,1,0], color=['yellow','purple','pink'])

    fig.set_title('3D Scatter')
    fig.set_legend()
    fig.set_xaxis(axis_name=iris.feature_names[0])
    fig.set_yaxis(axis_name=iris.feature_names[1])
    fig.set_zaxis(axis_name=iris.feature_names[2])
    fig.set_grid(alpha=20, beta=20, distance=200)
    fig.set_figsize((5,5))
    # fig.show()
    HTML(fig.show(return_html=True, silent=True))





.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

                <!DOCTYPE html>
                <html lang="en" style="height: 100%">
                <head>
                <meta charset="utf-8">
                </head>
                <body style="height: 100%; margin: 0">

            
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"></script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
            
                <div id="1742883546.34891130.4934" style="height: 500px; width: 500px; overflow: auto"></div>
            
                <script type="text/javascript">
                var dom = document.getElementById('1742883546.34891130.4934');
                dom.innerHTML = ""
                dom.setAttribute('_echarts_instance_', '')
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
        option = {"chart_id": "1742883546.34891130.4934", "link_id": null, "figname": "", "title": {"show": true, "text": "3D Scatter", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "50%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid3D": {"show": true, "width": "auto", "height": "auto", "zlevel": -10, "left": "5%", "top": "10%", "right": "5%", "bottom": "5%", "boxWidth": 100, "boxHeight": 100, "boxDepth": 100, "environment": "auto", "viewControl": {"alpha": 20, "beta": 20, "maxAlpha": 360, "distance": 200}, "changed_name_key": {}, "containLabel": true}, "legend": {"show": true, "type": "plain", "width": "auto", "height": "auto", "orient": "vertical", "align": "auto", "itemWidth": 25, "itemHeight": 14, "symbolRotate": "inherit", "selectedMode": true, "padding": 5, "itemGap": 10, "z": 4, "left": "auto", "top": "10%", "right": "1%", "bottom": "auto", "borderColor": "#ccc", "borderWidth": 1, "inactiveColor": "#ccc", "inactiveBorderColor": "#ccc", "inactiveBorderWidth": "auto", "selected": {}, "textStyle": {"overflow": "truncate", "fontSize": 12, "color": "#747475"}, "pageButtonItemGap": 5, "pageButtonPosition": "end", "pageFormatter": "{current}/{total}", "pageIconColor": "#2f4554", "pageIconInactiveColor": "#aaa", "pageIconSize": 15, "animationDurationUpdate": 800, "selectorItemGap": 7, "selectorButtonGap": 10}, "xAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "sepal length (cm)", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": 2.4775, "max": 9.2641, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "yAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "sepal width (cm)", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": -0.145, "max": 5.2074, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "zAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "petal length (cm)", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": -3.6617, "max": 10.6554, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "brush": null, "series": [{"type": "scatter3D", "name": "2", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [4.9, 2.5, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.8, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.5, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.8, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.0, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.2, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 3.0, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 3.0, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.6, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.8, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 3.4, 5.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.4, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.7, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.5, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.8, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.3, 6.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.9, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.2, 5.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.7, 5.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.8, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.1, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.8, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.2], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.2, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 2.5, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.0, 5.2], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.3, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.3, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 3.2, 5.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 3.0, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.2, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 5.4], "itemStyle": {"opacity": 1.0}}, {"value": [7.1, 3.0, 5.9], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.0, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.6, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.2, 6.0], "itemStyle": {"opacity": 1.0}}, {"value": [7.3, 2.9, 6.3], "itemStyle": {"opacity": 1.0}}, {"value": [7.4, 2.8, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.6, 3.0, 6.6], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 3.8, 6.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 3.0, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 2.8, 6.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 2.6, 6.9], "itemStyle": {"opacity": 1.0}}, {"value": [7.9, 3.8, 6.4], "itemStyle": {"opacity": 1.0}}], "silent": false, "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "yellow", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 15, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "scatter3D", "name": "2", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": true, "formatter": "2", "fontSize": 12, "width": 200, "overflow": "break"}, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [7.865207494878185, 2.8310716769384303, 8.628960938869469]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "yellow", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 1, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "line3D", "name": "2", "colorBy": "series", "zlevel": -10, "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "seriesLayoutBy": "column", "data": [{"value": [7.865207494878185, 2.8310716769384303, 8.628960938869469]}, {"value": [5.006, 3.428, 1.4620000000000002]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 500, "animationEasingUpdate": "cubicOut", "color": "yellow", "coordinateSystem": "cartesian3D"}, {"type": "scatter3D", "name": "1", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [4.9, 2.4, 3.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 2.0, 3.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 2.3, 3.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 2.5, 3.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 2.7, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.0, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.5, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.3, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.4, 3.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.4, 3.8], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.6, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.5, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 3.0, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.9, 3.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 3.0, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.7, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.8, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.9, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 3.0, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.8, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.6, 3.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.6, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.0, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.2, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 3.4, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.2, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.9, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.9, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.8, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.8, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 3.0, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.2, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.9, 4.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.3, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.5, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.3, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.9, 4.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.2, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 2.8, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.6, 3.0, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.6, 2.9, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.0, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 2.8, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [7.0, 3.2, 4.7], "itemStyle": {"opacity": 1.0}}], "silent": false, "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "purple", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 15, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "scatter3D", "name": "1", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": true, "formatter": "1", "fontSize": 12, "width": 200, "overflow": "break"}, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [6.4634979369080625, 1.1343769006663367, 7.117596737350912]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "purple", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 1, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "line3D", "name": "1", "colorBy": "series", "zlevel": -10, "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "seriesLayoutBy": "column", "data": [{"value": [6.4634979369080625, 1.1343769006663367, 7.117596737350912]}, {"value": [5.006, 3.428, 1.4620000000000002]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 500, "animationEasingUpdate": "cubicOut", "color": "purple", "coordinateSystem": "cartesian3D"}, {"type": "scatter3D", "name": "0", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [4.3, 3.0, 1.1], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 2.9, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 3.0, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 3.2, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.5, 2.3, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.6, 1.0], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.2, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.4, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.7, 3.2, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.7, 3.2, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.4, 1.9], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.1, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.4, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.6, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.5, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.2, 1.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.5, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.4, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.0, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.3, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.6, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.3, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.5, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.5, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 4.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 3.4, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 3.5, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.3, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.9, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.4, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.9, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 3.5, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 4.2, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 3.8, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 4.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 4.0, 1.2], "itemStyle": {"opacity": 1.0}}], "silent": false, "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "pink", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 15, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "scatter3D", "name": "0", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": true, "formatter": "0", "fontSize": 12, "width": 200, "overflow": "break"}, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [3.8764300755532988, 3.9280325461722656, -1.6353239011102234]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "pink", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 1, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "line3D", "name": "0", "colorBy": "series", "zlevel": -10, "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "seriesLayoutBy": "column", "data": [{"value": [3.8764300755532988, 3.9280325461722656, -1.6353239011102234]}, {"value": [5.006, 3.428, 1.4620000000000002]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 500, "animationEasingUpdate": "cubicOut", "color": "pink", "coordinateSystem": "cartesian3D"}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataView": {"readOnly": "false"}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": null, "dataZoom": null, "radar": null, "event": null, "graphic": null, "figsize": {"height": 500, "width": 500}, "color": ["#1f77b4", "#ff7f0e", "#2ca02c", "#e377c2", "#9467bd", "#d62728", "#8c564b", "#bcbd22", "#17becf", "#7f7f7f"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5005"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };function support_popup(option, height, width, inner_html) {
      option['toolbox']['feature']['myFeature'] = {
        show: true,
        title: 'Open in new window',
        icon: "image://data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iNDhweCIgd2lkdGg9IjQ4cHgiIHZpZXdCb3g9IjE2MCAtODAwIDY0MCA2NDAiIGZpbGw9IiM2NjY2NjYiPg0KICA8cGF0aCBkPSJNMjE1LjM4LTE2MHEtMjMuMDUgMC0zOS4yMi0xNi4xNlExNjAtMTkyLjMzIDE2MC0yMTUuMzh2LTUyOS4yNHEwLTIzLjA1IDE2LjE2LTM5LjIyUTE5Mi4zMy04MDAgMjE1LjM4LTgwMGgyMjQuMzl2MzAuNzdIMjE1LjM4cS05LjIzIDAtMTYuOTIgNy42OS03LjY5IDcuNjktNy42OSAxNi45MnY1MjkuMjRxMCA5LjIzIDcuNjkgMTYuOTIgNy42OSA3LjY5IDE2LjkyIDcuNjloNTI5LjI0cTkuMjMgMCAxNi45Mi03LjY5IDcuNjktNy42OSA3LjY5LTE2Ljkydi0yMjQuMzlIODAwdjIyNC4zOXEwIDIzLjA1LTE2LjE2IDM5LjIyUTc2Ny42Ny0xNjAgNzQ0LjYyLTE2MEgyMTUuMzhabTE3MS4yNC0yMDQuMzgtMjItMjIuMjQgMzgyLjYxLTM4Mi42MUg1NDEuMzFWLTgwMEg4MDB2MjU4LjY5aC0zMC43N1YtNzQ3TDM4Ni42Mi0zNjQuMzhaIi8+DQo8L3N2Zz4NCg==",
        onclick: function (){
          var height_ = Math.min(screen.height, Math.round(1.5 * parseInt(height.slice(0,-2))))
          var width_ = Math.min(screen.width, Math.round(1.5 * parseInt(width.slice(0,-2))))
          var left = (screen.width/2)-(width_/2);
          var top = (screen.height/2)-(height_/2);
          var win = window.open('template.html', '_blank',
            `height=${height_}px, width=${width_}px, top=${top}px, left=${left}px`,
          );
          win.document.write(`${inner_html}`);
          win.document.close();
        }
      };
      return option;
    };option = support_popup(option=option, height="500px", width="500px", inner_html=`

            <html lang="en" style="height: 100%; text-align: -webkit-center; align-content: center">
            <title>MoCharts</title>
            <head> <meta charset="utf-8"> </head>
            <body style="height: 100%; margin: 0">
        
        
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.8/echarts-gl.min.js"><\/script>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"><\/script>
                <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"><\/script>
            

            <div id="1742883546.34891130.4934" style="height: 90%; width: 90%"></div>
            <script type="text/javascript">
                var dom = document.getElementById('1742883546.34891130.4934');
                var myChart = echarts.init(dom, null, {
                    renderer: 'canvas',
                    useDirtyRect: false
                    });
                var app = {};

                var option;
            option = {"chart_id": "1742883546.34891130.4934", "link_id": null, "figname": "", "title": {"show": true, "text": "3D Scatter", "link": "", "target": "blank", "textStyle": {"fontStyle": "normal", "fontWeight": "bolder", "fontFamily": "sans-serif", "fontSize": 15, "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "subtext": "", "sublink": "", "subtarget": "blank", "textAlign": "center", "textVerticalAlign": "auto", "padding": 0, "itemGap": 10, "z": 2, "left": "50%", "top": "5%", "right": "auto", "bottom": "auto", "backgroundColor": "transparent", "borderColor": "#ccc", "changed_name_key": {"id_": "id"}}, "grid3D": {"show": true, "width": "auto", "height": "auto", "zlevel": -10, "left": "5%", "top": "10%", "right": "5%", "bottom": "5%", "boxWidth": 100, "boxHeight": 100, "boxDepth": 100, "environment": "auto", "viewControl": {"alpha": 20, "beta": 20, "maxAlpha": 360, "distance": 200}, "changed_name_key": {}, "containLabel": true}, "legend": {"show": true, "type": "plain", "width": "auto", "height": "auto", "orient": "vertical", "align": "auto", "itemWidth": 25, "itemHeight": 14, "symbolRotate": "inherit", "selectedMode": true, "padding": 5, "itemGap": 10, "z": 4, "left": "auto", "top": "10%", "right": "1%", "bottom": "auto", "borderColor": "#ccc", "borderWidth": 1, "inactiveColor": "#ccc", "inactiveBorderColor": "#ccc", "inactiveBorderWidth": "auto", "selected": {}, "textStyle": {"overflow": "truncate", "fontSize": 12, "color": "#747475"}, "pageButtonItemGap": 5, "pageButtonPosition": "end", "pageFormatter": "{current}/{total}", "pageIconColor": "#2f4554", "pageIconInactiveColor": "#aaa", "pageIconSize": 15, "animationDurationUpdate": 800, "selectorItemGap": 7, "selectorButtonGap": 10}, "xAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "sepal length (cm)", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": 2.4775, "max": 9.2641, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "yAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "sepal width (cm)", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": "auto", "min": -0.145, "max": 5.2074, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "zAxis3D": [{"show": true, "type": "value", "position": "bottom", "name": "petal length (cm)", "nameLocation": "center", "nameTextStyle": {"color": "#747475", "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "nameGap": 30, "min": -3.6617, "max": 10.6554, "splitNumber": 3, "logBase": 10, "axisLine": {}, "axisTick": {"show": true, "alignWithLabel": "none", "interval": "auto", "length": 5}, "axisLabel": {"show": true, "margin": 8, "showMinLabel": false, "showMaxLabel": false, "fontStyle": "normal", "fontWeight": "normal", "fontFamily": "sans-serif", "fontSize": 12, "backgroundColor": "transparent", "borderType": "solid", "shadowColor": "transparent", "textBorderType": "solid", "textShadowColor": "transparent", "overflow": "none", "ellipsis": "..."}, "splitLine": {"show": true, "interval": "auto"}, "splitArea": {"show": false, "interval": "auto"}, "axisPointer": {"show": false}, "dimension": "3d", "ignored": false, "changed_name_key": {"min_": "min", "max_": "max", "type_": "type", "name_": "name"}}], "brush": null, "series": [{"type": "scatter3D", "name": "2", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [4.9, 2.5, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.8, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.5, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.8, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.0, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.2, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 3.0, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 3.0, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.6, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.8, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 3.4, 5.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.4, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.7, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.5, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.8, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.3, 6.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.9, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.2, 5.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.7, 5.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.8, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.1, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.8, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.2], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.2, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 3.0, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 2.5, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.0, 5.2], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.3, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 5.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.3, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 3.2, 5.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 3.0, 5.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.2, 5.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 5.4], "itemStyle": {"opacity": 1.0}}, {"value": [7.1, 3.0, 5.9], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.0, 5.8], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.6, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.2, 3.2, 6.0], "itemStyle": {"opacity": 1.0}}, {"value": [7.3, 2.9, 6.3], "itemStyle": {"opacity": 1.0}}, {"value": [7.4, 2.8, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.6, 3.0, 6.6], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 3.8, 6.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 3.0, 6.1], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 2.8, 6.7], "itemStyle": {"opacity": 1.0}}, {"value": [7.7, 2.6, 6.9], "itemStyle": {"opacity": 1.0}}, {"value": [7.9, 3.8, 6.4], "itemStyle": {"opacity": 1.0}}], "silent": false, "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "yellow", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 15, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "scatter3D", "name": "2", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": true, "formatter": "2", "fontSize": 12, "width": 200, "overflow": "break"}, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [7.865207494878185, 2.8310716769384303, 8.628960938869469]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "yellow", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 1, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "line3D", "name": "2", "colorBy": "series", "zlevel": -10, "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "seriesLayoutBy": "column", "data": [{"value": [7.865207494878185, 2.8310716769384303, 8.628960938869469]}, {"value": [5.006, 3.428, 1.4620000000000002]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 500, "animationEasingUpdate": "cubicOut", "color": "yellow", "coordinateSystem": "cartesian3D"}, {"type": "scatter3D", "name": "1", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [4.9, 2.4, 3.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 2.0, 3.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 2.3, 3.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 2.5, 3.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 2.7, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.0, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.5, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.3, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.4, 3.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.4, 3.8], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 2.6, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.5, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 3.0, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.9, 3.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 3.0, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.6, 2.7, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.8, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.9, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 3.0, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.8, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 2.6, 3.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 4.1], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.7, 3.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 2.6, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.0, 4.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.9, 3.2, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 3.4, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.7, 5.1], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.2, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.0, 2.9, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.9, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.8, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 2.8, 4.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.1, 3.0, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.2, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.2, 2.9, 4.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 3.3, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.5, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [6.3, 2.3, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 2.9, 4.3], "itemStyle": {"opacity": 1.0}}, {"value": [6.4, 3.2, 4.5], "itemStyle": {"opacity": 1.0}}, {"value": [6.5, 2.8, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.6, 3.0, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.6, 2.9, 4.6], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.0, 5.0], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 4.4], "itemStyle": {"opacity": 1.0}}, {"value": [6.7, 3.1, 4.7], "itemStyle": {"opacity": 1.0}}, {"value": [6.8, 2.8, 4.8], "itemStyle": {"opacity": 1.0}}, {"value": [6.9, 3.1, 4.9], "itemStyle": {"opacity": 1.0}}, {"value": [7.0, 3.2, 4.7], "itemStyle": {"opacity": 1.0}}], "silent": false, "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "purple", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 15, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "scatter3D", "name": "1", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": true, "formatter": "1", "fontSize": 12, "width": 200, "overflow": "break"}, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [6.4634979369080625, 1.1343769006663367, 7.117596737350912]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "purple", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 1, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "line3D", "name": "1", "colorBy": "series", "zlevel": -10, "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "seriesLayoutBy": "column", "data": [{"value": [6.4634979369080625, 1.1343769006663367, 7.117596737350912]}, {"value": [5.006, 3.428, 1.4620000000000002]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 500, "animationEasingUpdate": "cubicOut", "color": "purple", "coordinateSystem": "cartesian3D"}, {"type": "scatter3D", "name": "0", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [4.3, 3.0, 1.1], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 2.9, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 3.0, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.4, 3.2, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.5, 2.3, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.6, 1.0], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.2, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.6, 3.4, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.7, 3.2, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [4.7, 3.2, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.4, 1.9], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.1, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.4, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [4.8, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.6, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [4.9, 3.0, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.5, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.2, 1.2], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.5, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.4, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.0, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.3, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.6, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.0, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.3, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.6], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.9], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.8, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.5, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.1, 3.5, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 4.1, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 3.4, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.2, 3.5, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.3, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.9, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.7, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.4, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.4, 3.9, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 3.5, 1.3], "itemStyle": {"opacity": 1.0}}, {"value": [5.5, 4.2, 1.4], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 3.8, 1.7], "itemStyle": {"opacity": 1.0}}, {"value": [5.7, 4.4, 1.5], "itemStyle": {"opacity": 1.0}}, {"value": [5.8, 4.0, 1.2], "itemStyle": {"opacity": 1.0}}], "silent": false, "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "pink", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 15, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "scatter3D", "name": "0", "colorBy": "series", "z": 2, "legendHoverLink": false, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "label": {"show": true, "formatter": "0", "fontSize": 12, "width": 200, "overflow": "break"}, "emphasis": {"label": {"show": false}}, "seriesLayoutBy": "column", "data": [{"value": [3.8764300755532988, 3.9280325461722656, -1.6353239011102234]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "cubicOut", "animationDurationUpdate": 300, "animationEasingUpdate": "cubicOut", "color": "pink", "blendMode": "source-over", "symbol": "arrow", "symbolSize": 1, "symbolOffset": [0, 0], "largeThreshold": 2000, "progressive": 400, "progressiveThreshold": 3000}, {"type": "line3D", "name": "0", "colorBy": "series", "zlevel": -10, "z": 2, "legendHoverLink": true, "stackStrategy": "samesign", "cursor": "pointer", "clip": true, "seriesLayoutBy": "column", "data": [{"value": [3.8764300755532988, 3.9280325461722656, -1.6353239011102234]}, {"value": [5.006, 3.428, 1.4620000000000002]}], "animation": true, "animationThreshold": 2000, "animationDuration": 1000, "animationEasing": "linear", "animationDurationUpdate": 500, "animationEasingUpdate": "cubicOut", "color": "pink", "coordinateSystem": "cartesian3D"}], "visualMap": null, "toolbox": {"show": true, "orient": "horizontal", "itemSize": 15, "itemGap": 8, "showTitle": true, "feature": {"dataView": {"readOnly": "false"}, "saveAsImage": {}}, "z": 2, "left": "auto", "top": "auto", "right": "1%", "bottom": "auto", "width": "auto", "height": "auto", "popup": true, "changed_name_key": {"id_": "id"}}, "tooltip": null, "dataZoom": null, "radar": null, "event": null, "graphic": null, "figsize": {"height": 500, "width": 500}, "color": ["#1f77b4", "#ff7f0e", "#2ca02c", "#e377c2", "#9467bd", "#d62728", "#8c564b", "#bcbd22", "#17becf", "#7f7f7f"], "save_img": false, "auto_size": true, "style": {"overflow": "auto"}, "port": "5005"};function setInnerHTML(elm, html) {
      elm.innerHTML = html;
  
      Array.from(elm.querySelectorAll("script"))
        .forEach( oldScriptEl => {
          const newScriptEl = document.createElement("script");
      
          Array.from(oldScriptEl.attributes).forEach( attr => {
            newScriptEl.setAttribute(attr.name, attr.value) 
          });
      
          const scriptText = document.createTextNode(oldScriptEl.innerHTML);
          newScriptEl.appendChild(scriptText);
      
          oldScriptEl.parentNode.replaceChild(newScriptEl, oldScriptEl);
      });
    };

    function getScreenSize(option) {
      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_result_save', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'height': screen.height, 'width': screen.width},
                                  'event_id': 'screen_size'})
          });
          fetch(testRequest).then(response => {});
      return 
    }
    function support_scientific_notation(option) {
      if (Array.isArray(option['yAxis'])) {
        for (var tar_ind = 0; tar_ind < option['yAxis'].length; tar_ind++) {
          if (option['yAxis'][tar_ind]['type'] === 'value') {
            option['yAxis'][tar_ind]['axisLabel']['formatter'] = function(val) {
              const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                        '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                        '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
              function toSuperscript(val) {
                if (val.toString().length > 5 && !val.toString().includes('.')) {
                  val = Number(val).toExponential().toString();
                  if (val.includes('-')) {
                    val = val.split('-');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁻' + val1
                  }
                  else if (val.includes('+')) {
                    val = val.split('+');
                    var val0 = val[0];
                    var val1 = superscripts[val[1]];
                    return val0 + '⁺' + val1
                  }
                }
                else {
                  return val
                }
              }
              return toSuperscript(val)
            }
          }
        }
      }
      else {
        if (option['yAxis']['type'] === 'value') {
          option['yAxis']['axisLabel']['formatter'] = function(val) {
            const superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹','¹⁰',
                    '¹¹', '¹²', '¹³', '¹⁴', '¹⁵', '¹⁶', '¹⁷', '¹⁸', '¹⁹','²⁰',
                    '²¹', '²²', '²³', '²⁴', '²⁵', '²⁶', '²⁷', '²⁸', '²⁹'];
            function toSuperscript(val) {
              if (val.toString().length > 5 && !val.toString().includes('.')) {
                val = Number(val).toExponential().toString();
                if (val.includes('-')) {
                  val = val.split('-');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁻' + val1
                }
                else if (val.includes('+')) {
                  val = val.split('+');
                  var val0 = val[0];
                  var val1 = superscripts[val[1]];
                  return val0 + '⁺' + val1
                }
              }
              else {
                return val
              }
            }
            return toSuperscript(val)
          }
        }
      };
      return option;
    };

    function auto_component_size(option) {
      if (typeof option['figsize']['width'] === 'string' || option['figsize']['width'] instanceof String) {
        if (option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['width'].includes('px')) {
          var width = parseFloat(option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = option['figsize']['width']
      }

      if (typeof option['figsize']['height'] === 'string' || option['figsize']['height'] instanceof String) {
        if (option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (option['figsize']['height'].includes('px')) {
          var height = parseFloat(option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height']
      }

      var relative_ratio = Math.min(width / 700, height / 400)
      if ('xAxis3D' in option) {
        var keys = ['xAxis3D', 'yAxis3D', 'zAxis3D']
      }
      else {
        var keys = ['xAxis', 'yAxis']
      }
      for (single_key of keys) {
        for (var ind = 0; ind < option[single_key].length; ind++) {
          option[single_key][ind]['nameTextStyle']['fontSize'] = Math.max(7, option[single_key][ind]['nameTextStyle']['fontSize'] * relative_ratio);
          option[single_key][ind]['axisLabel']['fontSize'] = Math.max(7, option[single_key][ind]['axisLabel']['fontSize'] * relative_ratio);
        }
      }
      if (option['series']) {
        for (var ind = 0; ind < option['series'].length; ind++) {
          if (['heatmap', 'bar'].includes(option['series'][ind]['type'])) {
            if (option['series'][ind]['label']) {
              option['series'][ind]['label']['fontSize'] = Math.max(7, option['series'][ind]['label']['fontSize'] * relative_ratio);
            }
          }
        }
      }
      if (option['title']) {
        if (Array.isArray(option['title'])) {
          for (var ind = 0; ind < option['title'].length; ind++) {
            option['title'][ind]['textStyle']['fontSize'] = Math.max(9, option['title'][ind]['textStyle']['fontSize'] * relative_ratio);
          }
        }
        else {
          option['title']['textStyle']['fontSize'] = Math.max(9, option['title']['textStyle']['fontSize'] * relative_ratio);
        }
      }
      if (option['legend']) {
        option['legend']['itemHeight'] = option['legend']['itemHeight'] * relative_ratio;
        option['legend']['itemWidth'] = option['legend']['itemWidth'] * relative_ratio;
        option['legend']['textStyle']['fontSize'] = Math.max(7, option['legend']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['visualMap']) {
        option['visualMap']['itemHeight'] = option['visualMap']['itemHeight'] * relative_ratio;
        option['visualMap']['itemWidth'] = option['visualMap']['itemWidth'] * relative_ratio;
        option['visualMap']['textStyle']['fontSize'] = Math.max(7, option['visualMap']['textStyle']['fontSize'] * relative_ratio);
      }
      if (option['toolbox']) {
        option['toolbox']['itemSize'] = Math.max(8, option['toolbox']['itemSize'] * relative_ratio)
        option['toolbox']['itemGap'] = Math.max(4, option['toolbox']['itemGap'] * relative_ratio);
      }
      if (option['graphic']) {
        for (var ind = 0; ind < option['graphic'].length; ind++) {
          for (var ind2 = 0; ind2 < option['graphic'][ind]['children'].length; ind2++) {
            var new_font = Math.max(7, 12 * relative_ratio);
            option['graphic'][ind]['children'][ind2]['style']['font'] = new_font.toString() + 'px Microsoft YaHei';
          }
        }
      }
      return option;
    }

    function save_img(echarts_instance, option) {
      const base64_str = echarts_instance.getDataURL({
          pixelRatio: 2,
          backgroundColor: '#fff',
          width: option['figsize']['width'],
          height: option['figsize']['height']
      });

      let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_image_save', {
        method: 'post',
        headers: {
          'Content-Type': 'application/json;charset=utf-8;',
          'Access-Control-Allow-Origin':'*',
          'Access-Control-Allow-Credentials': 'true',
          'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
        },
        body: JSON.stringify({'figname': option['figname'],
                              'base64_str': base64_str})
      });
      fetch(testRequest).then(response => {});
    };


    function auto_axis_namegap(echarts_instance, auto_axis_list, axis_type) {
      const globalModel = echarts_instance._api.getModel()
      const figsize = globalModel.option.figsize
      const ctx = document.createElement('canvas').getContext('2d')
      if (typeof globalModel.option['figsize']['width'] === 'string' || globalModel.option['figsize']['width'] instanceof String) {
        if (globalModel.option['figsize']['width'].includes('%')) {
          var width = 800 * (parseFloat(globalModel.option['figsize']['width'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['width'].includes('px')) {
          var width = parseFloat(globalModel.option['figsize']['width'].slice(0,-2));
        }
      }
      else {
        var width = globalModel.option['figsize']['width'];
      }

      if (typeof globalModel.option['figsize']['height'] === 'string' || globalModel.option['figsize']['height'] instanceof String) {
        if (globalModel.option['figsize']['height'].includes('%')) {
          var height = 600 * (parseFloat(globalModel.option['figsize']['height'].slice(0,-1)) / 100);
        }
        else if (globalModel.option['figsize']['height'].includes('px')) {
          var height = parseFloat(globalModel.option['figsize']['height'].slice(0,-2));
        }
      }
      else {
        var height = option['figsize']['height'];
      }
      var relative_ratio = Math.min(width / 700, height / 400);
      if (axis_type==='2d') {
        const yAxisList = globalModel.option.yAxis
        const xAxisList = globalModel.option.xAxis

        for (var axis_idx of auto_axis_list) {
          const yAxis = yAxisList[axis_idx]
          const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
          const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
          ctx.save()
          ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
  
          const yAxisComponent = globalModel.getComponent('yAxis', axis_idx)?.axis
          if (yAxis.type === 'value') {
            var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
          }
          else {
            var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
          }
          var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
          axisLabelMargin = axisLabelMargin * relative_ratio
          yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
          ctx.restore()
        };
  
        for (var axis_idx of [...Array(xAxisList.length).keys()]) {
          var new_gap = Math.max(xAxisList[axis_idx].nameGap * relative_ratio, 12);
          if (figsize['height'] < 400) {
            new_gap = Math.min(20, new_gap);
          }
          xAxisList[axis_idx].nameGap = new_gap;
        }
  
        echarts_instance.setOption({
          yAxis: yAxisList,
          xAxis: xAxisList
        })
      }
      else {
        const yAxisList = globalModel.option.yAxis3D
        const xAxisList = globalModel.option.xAxis3D
        const zAxisList = globalModel.option.zAxis3D

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < xAxisList.length) {
            const xAxis = xAxisList[axis_idx]
            const fontSize = xAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = xAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const xAxisComponent = globalModel.getComponent('xAxis3D', axis_idx)?.axis
            if (xAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...xAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = xAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            xAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < yAxisList.length) {
            const yAxis = yAxisList[axis_idx]
            const fontSize = yAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = yAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const yAxisComponent = globalModel.getComponent('yAxis3D', axis_idx)?.axis
            if (yAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...yAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = yAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            yAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };

        for (var axis_idx of auto_axis_list) {
          if (axis_idx < zAxisList.length) {
            const zAxis = zAxisList[axis_idx]
            const fontSize = zAxis.nameTextStyle?.fontSize ?? 12
            const fontFamily = zAxis.nameTextStyle?.fontFamily ?? 'sans-serif'
            ctx.save()
            ctx.font = fontSize.toString() + 'px' + fontFamily.toString()
    
            const zAxisComponent = globalModel.getComponent('zAxis3D', axis_idx)?.axis
            if (zAxis.type === 'value') {
              var labelMaxWidth = Math.min(Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width)), 30)
            }
            else {
              var labelMaxWidth = Math.max(...zAxisComponent.getViewLabels().map(item => ctx.measureText(item.formattedLabel).width))
            }
            var axisLabelMargin = zAxis.axisLabel?.margin ?? 8
            axisLabelMargin = axisLabelMargin * relative_ratio
            zAxisList[axis_idx].nameGap = labelMaxWidth + axisLabelMargin + 5 * relative_ratio
            ctx.restore()
          }
        };
        echarts_instance.setOption({
          yAxis3D: yAxisList,
          xAxis3D: xAxisList,
          zAxis3D: zAxisList
        });
        }
  
    };

    function custom_scatter_size(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['symbolSize'] === 'array_size') {
          var ind_ = option['series'][ind]['data_dict']['size']
          option['series'][ind]['symbolSize'] = function (data) {return data[ind_];}
        }
      }
      return option;
  
    };

    function show_scatter_label(option) {
  
      for (var ind = 0; ind < option['series'].length; ind++) {
        if (option['series'][ind]['label'] === 'show_label') {
          var ind_ = option['series'][ind]['data_dict']['label']
          option['series'][ind]['label'] = {
            show: true,
            formatter: function (params) {return params.data.value[ind_]; }
          }
        }
      }
      return option;
    };

    function hide_min_max_axis_label(option) {
      for (var ind = 0; ind < option['xAxis3D'].length; ind++) {
        if (option['xAxis3D'][ind]['type'] == 'value') {
          var x_min = option['xAxis3D'][ind]['min']
          var x_max = option['xAxis3D'][ind]['max']
          option['xAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==x_min || value==x_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['yAxis3D'].length; ind++) {
        if (option['yAxis3D'][ind]['type'] == 'value') {  
          var y_min = option['yAxis3D'][ind]['min']
          var y_max = option['yAxis3D'][ind]['max']
          option['yAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==y_min || value==y_max){}
            else {return value}
          }
        }
      }
      for (var ind = 0; ind < option['zAxis3D'].length; ind++) {
        if (option['zAxis3D'][ind]['type'] == 'value') {
          var z_min = option['zAxis3D'][ind]['min']
          var z_max = option['zAxis3D'][ind]['max']
          option['zAxis3D'][ind]['axisLabel']['formatter'] = function (value, index) {
            if (value==z_min || value==z_max){}
            else {return value}
          }
       }
      }
      return option;
    }

    function custom_axis_label(option) {
      if (Array.isArray(option['xAxis'])) {
        for (var ind = 0; ind < option['xAxis'].length; ind++) {
          if (option['xAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['xAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['xAxis'][ind]['axisLabel']['formatter_func'].body)
            option['xAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['xAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['xAxis']['axisLabel']['formatter_func'].arguments,
                               option['xAxis']['axisLabel']['formatter_func'].body)
          option['xAxis']['axisLabel']['formatter'] = f
        }
      }
      if (Array.isArray(option['yAxis'])) {
        for (var ind = 0; ind < option['yAxis'].length; ind++) {
          if (option['yAxis'][ind]['axisLabel']['formatter_func']) {
            var f = new Function(option['yAxis'][ind]['axisLabel']['formatter_func'].arguments,
                                 option['yAxis'][ind]['axisLabel']['formatter_func'].body)
            option['yAxis'][ind]['axisLabel']['formatter'] = f
          }
        }
      }
      else {
        if (option['yAxis']['axisLabel']['formatter_func']) {
          var f = new Function(option['yAxis']['axisLabel']['formatter_func'].arguments,
                               option['yAxis']['axisLabel']['formatter_func'].body)
          option['yAxis']['axisLabel']['formatter'] = f
        }
      }
      return option;
    }

    function custom_tooltip(option, dimension=2) {

      if (dimension === 2) {
        var xaxis_key = 'xAxis'
        var yaxis_key = 'yAxis'
      }

      else if (dimension === 3) {
        var xaxis_key = 'xAxis3D'
        var yaxis_key = 'yAxis3D'
        var zaxis_key = 'zAxis3D'
      }

      if (option['radar']) {
        var radar_names = []
        for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
          radar_names.push(option['radar']['indicator'][ind_]['name']) 
        }
      }
  
  
      if (option[xaxis_key]['name'] !== null && option[xaxis_key]['name'] !== '' && Array.isArray(option[xaxis_key])!==true) {
        var xaxis_name = option[xaxis_key]['name'];
      }
      else {
        var xaxis_name = 'X';
      }

      if (option[yaxis_key]['name'] !== null && option[yaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
        var yaxis_name = option[yaxis_key]['name'];
      }
      else {
        var yaxis_name = 'Y';
      }

      if (typeof zaxis_key !== 'undefined') {
        if (option[zaxis_key]['name'] !== ''&& Array.isArray(option[xaxis_key])!==true) {
          var zaxis_name = option[zaxis_key]['name'];
        }
        else {
          var zaxis_name = 'Z';
        }
      }
  
      if (option['tooltip']) {
        if (option['tooltip']['precision']) {
          var precision = option['tooltip']['precision']
          option['tooltip']['valueFormatter'] = (value) =>  Math.round(Number(value) * (10**precision)) / (10**precision)
        }

        for (var ind_ = 0; ind_ < option['series'].length; ind_++) {
          if (option['series'][ind_]['tooltip']) {
            if (option['series'][ind_]['tooltip']['precision']) {
              var precision = option['series'][ind_]['tooltip']['precision']
              const fix = precision_ => value => Math.round(Number(value) * (10**precision_)) / (10**precision_),
              fix_p = fix(precision);
              option['series'][ind_]['tooltip']['valueFormatter'] = function (value) {
                return fix_p(value)
              } 
            }
          }
        }

        if (option['series'].length === 1) {
          if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][0]['type'])) {
            option['tooltip']['formatter'] = function(params) {
              if (params.seriesName.includes('series')) {
                var series_name = ''
              }
          
              else {
                var series_name = params.seriesName + '<br>'
              }
      
              if (params.seriesType === 'scatter') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                  + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                  +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                }
            
              }
  
              else if (params.seriesType === 'heatmap') {
                formatter = params.name + ', ' + option['yAxis'][0]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
              }
      
              else if (params.seriesType === 'scatter3D') {
                if (option['tooltip']['custom_tooltip'] === true) {
                  formatter = series_name
                    + params.value[dimension]
                }
                else {
                  formatter = series_name
                    + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                    +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                    +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                }
              }
          
              else if (params.seriesType === 'radar') {
                formatter = params.name  + '<br>';
                for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                  if (ind_ !== option['radar']['indicator'].length - 1) {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                  }
                  else {
                    formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                  }
                }
              }
            return formatter;
            }
          }
        }
        else {
          for (var out_ind_ = 0; out_ind_ < option['series'].length; out_ind_++) {
            if (['scatter', 'heatmap', 'scatter3D', 'radar'].includes(option['series'][out_ind_]['type'])) {
              if (option['series'][out_ind_]['tooltip']) {
              }
              else {
                option['series'][out_ind_]['tooltip'] = {}
              }
              option['series'][out_ind_]['tooltip']['formatter'] = function(params) {
                if (params.seriesName.includes('series')) {
                  var series_name = ''
                }
            
                else {
                  var series_name = params.seriesName + '<br>'
                }
        
                if (params.seriesType === 'scatter') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                  }
                }
    
                else if (params.seriesType === 'heatmap') {
                  if ('data' in option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]) {
                    formatter = params.name + ', ' + option['yAxis'][option['series'][params.seriesIndex]['yAxisIndex']]['data'][params.data[1]] + '<br> <b>' + Math.round(params.data[2] * 10000) / 10000
                  }
                  else {
                    formatter = Math.round(params.data[2] * 10000) / 10000
                  }
                
                }
        
                else if (params.seriesType === 'scatter3D') {
                  if (option['tooltip']['custom_tooltip'] === true) {
                    formatter = series_name
                      + params.value[dimension]
                  }
                  else {
                    formatter = series_name
                      + xaxis_name + ': '+ Math.round(params.value[0] * 100) / 100
                      +'<br>' + yaxis_name + ': ' + Math.round(params.value[1] * 100) / 100
                      +'<br>' + zaxis_name + ': ' + Math.round(params.value[2] * 100) / 100
                  }
                }
            
                else if (params.seriesType === 'radar') {
                  formatter = params.name  + '<br>';
                  for (var ind_ = 0; ind_ < option['radar']['indicator'].length; ind_++) {
                    if (ind_ !== option['radar']['indicator'].length - 1) {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100 + '<br>'
                    }
                    else {
                      formatter += radar_names[ind_] + ': ' + Math.round(params.value[ind_] * 100) / 100
                    }
                  }
                }
              return formatter;
              }
            }
          }
        }
      }
      return option;
    };

    function support_brush_event(option) {
      if (option['event']['type_'] === 'brushselected') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var last_selected = [];
        bind_chart.on(option['event']['type_'], (params) => {
          var brushed = [];
          var brushComponent = params.batch[0];
          for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
            var rawIndices = brushComponent.selected[sIdx].dataIndex;
            brushed.push(rawIndices);
          }
          var brushed_all = brushed[0];

          if (JSON.stringify(last_selected) !== JSON.stringify(brushed_all)) {

            // Update memory
            let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
              method: 'post',
              headers: {
                  'Content-Type': 'application/json;charset=utf-8;',
                  'Access-Control-Allow-Origin':'*',
                  'Access-Control-Allow-Credentials': 'true',
                  'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
              },
              body: JSON.stringify({'js_func_input':{'selected': brushed_all},
                                    'event_id': option['event']['event_id']})
            });
            var dom_dict = {}
            fetch(testRequest).then(response => {
              var result = response.json();
              result.then(res => {
                dom_dict[res['link_id']] = document.getElementById(res['link_id']);
                setInnerHTML(dom_dict[res['link_id']], res['html']);
              });
            });
            last_selected = brushed_all;
          }
                            
        // bind_chart.setOption(option);
        })
      }
      return option;
    };

    function support_click_event(option) {
      if (option['event']['type_'] === 'click') {
        if (option['link_id'] === null) {
          var link_id = option['chart_id'];
        }
        else {
          var link_id = option['link_id'];
        }
        var dom = document.getElementById(link_id);
        var bind_chart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        if (option['series'][0]['orient'] === 'vertical') {
          var value_idx = 0
        }
        else {
          var value_idx = 1
        }
    

        bind_chart.on(option['event']['type_'], (params) => {
          if (option['event']['task'] === 'singleselect') {
            for (var ind_2 = 0; ind_2 < option['series'][0]['data'].length; ind_2++) {
              if (option['series'][0]['data'][ind_2]['itemStyle']['color'] !== '#1f77b4') {
                option['series'][0]['data'][ind_2]['itemStyle']['color'] = '#1f77b4';
              }
            }
            var idx = option['series'][0]['x_value'].indexOf(params.value[value_idx])
            option['series'][0]['data'][idx]['itemStyle']['color'] = '#ff7f0e';

            var selected = params.value[value_idx];
          }
          else {
            console.log(params);
          }
      
          let testRequest = new Request('http://localhost:' + option['port'] +'/function/js_call_python_function', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json;charset=utf-8;',
              'Access-Control-Allow-Origin':'*',
              'Access-Control-Allow-Credentials': 'true',
              'Access-Control-Allow-Methods':'POST,PATCH,OPTIONS'
            },
            body: JSON.stringify({'js_func_input':{'selected': selected},
                                  'event_id': option['event']['event_id']})
          });
          var dom_dict = {}
          fetch(testRequest).then(response => {
            var result = response.json();
            result.then(res => {
              dom_dict[res['link_id']] = document.getElementById(res['link_id']);
              setInnerHTML(dom_dict[res['link_id']], res['html']);
            });
          });
          bind_chart.setOption(option);
        });
      }
      return option;
    };option = custom_tooltip(option=option, dimension=3);option = auto_component_size(option=option);option = hide_min_max_axis_label(option=option);getScreenSize(option=option);

                myChart.setOption(option);
                window.addEventListener('resize', function () {
                    myChart.resize();
                    var option_copy = JSON.parse(JSON.stringify(option));
                    option_copy['figsize']['height'] = myChart.getHeight();
                    option_copy['figsize']['width'] = myChart.getWidth();
                    // option_copy = auto_component_size(option_copy);
                    myChart.setOption(option_copy);
                });
            <\/script>
            </body>
            </html>
        <style>
    .dg.main.taller-than-window .close-button {
        border-top: 1px solid #ddd;
    }

    .dg.main .close-button {
        background-color: #e8e8e8;
    }
 
    .dg.main .close-button:hover {
        background-color: #ddd;
    }

    .dg {
        color: #555;
        text-shadow: none !important;
    }

    .dg.main::-webkit-scrollbar {
        background: #fafafa;
    }

    .dg.main::-webkit-scrollbar-thumb {
        background: #bbb;
    }
 
    .dg li:not(.folder) {
        background: #fafafa;
        border-bottom: 1px solid #ddd;
    }
 
    .dg li.save-row .button {
        text-shadow: none !important;
    }

    .dg li.title {
        background: #e8e8e8 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;
    }

    .dg .cr.function:hover,.dg .cr.boolean:hover {
        background: #fff;
    }
 
    .dg .c input[type=text] {
        background: #e9e9e9;
    }
 
    .dg .c input[type=text]:hover {
        background: #eee;
    }
 
    .dg .c input[type=text]:focus {
        background: #eee;
        color: #555;
    }
 
    .dg .c .slider {
        background: #e9e9e9;
    }

    .dg .c .slider:hover {
        background: #eee;
    }<\/style>`);option = custom_tooltip(option=option, dimension=3);option = auto_component_size(option=option);option = hide_min_max_axis_label(option=option);getScreenSize(option=option);

                if (option && typeof option === 'object') {
                    myChart.setOption(option);
                    }

                auto_axis_namegap(echarts_instance=myChart, auto_axis_list=[0], axis_type="3d");

            </script>
            </body>
            </html>
    
    </div>
    <br />
    <br />


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.032 seconds)


.. _sphx_glr_download__source_auto_galleries_galleries_plots_plots_0_scatter3d.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plots_0_scatter3d.ipynb <plots_0_scatter3d.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plots_0_scatter3d.py <plots_0_scatter3d.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plots_0_scatter3d.zip <plots_0_scatter3d.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
